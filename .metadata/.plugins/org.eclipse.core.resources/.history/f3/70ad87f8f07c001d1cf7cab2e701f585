package com.jpmc.theater.bootstrap;

import java.io.Console;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

import com.github.javafaker.Faker;
import com.jpmc.theater.model.Customer;
import com.jpmc.theater.service.CustomerService;

import lombok.extern.slf4j.Slf4j;

@Component
@Slf4j
public class DefaultDataLoader implements CommandLineRunner {
	
	@Autowired
    private CustomerService customerService;
	@Autowired
    private Faker faker;

    @Override
    public void run(String... args) {
        loadCustomerData();
        
        Console console = System.console();

        String input = "";
        while (!"q".equalsIgnoreCase(input)) {

            System.out.print("Enter something (q to quite): ");

            input = console.readLine();
            System.out.println("input : " + input);
        }

        System.out.println("bye bye!");
    }

    private void loadCustomerData() {
        if (customerService.getCustomerCount() == 0) {
            log.info("Saving the default customer into the database.");
            for (int x = 0; x < 5; x++) {
            	customerService.save(createNewCustomer());
            }
        } else {
            log.info("Default customer are already present in the database.");
        }
    }

    private Customer createNewCustomer() {
        return new Customer(faker.name().firstName());
    }
}
