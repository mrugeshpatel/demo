package com.jpmc.theater.service;

import java.text.ParseException;
import java.util.Date;

import org.springframework.stereotype.Service;

import com.jpmc.theater.model.Movie;
import com.jpmc.theater.model.Showing;
import com.jpmc.theater.util.Constants;
import com.jpmc.theater.util.DateFormatter;

@Service
public class DiscountService {

	 public double getDiscount(final Movie movie, final Showing showing) throws ParseException {
	    double specialDiscount = 0;
	    if (Constants.MOVIE_CODE_SPECIAL == movie.getSpecialCode()) {
	        specialDiscount = movie.getTicketPrice() * 0.2;  // 20% discount for special movie
	    }
	    
		if (showing.getSequenceOfTheDay() == 1) {
			specialDiscount = specialDiscount > 3 ? specialDiscount : 3;  // $3 discount for 1st show
		}else if (showing.getSequenceOfTheDay() == 2) {
		    specialDiscount = specialDiscount > 2 ? specialDiscount : 2;  // $2 discount for 2nd show
		}else if (showing.getSequenceOfTheDay() == 7) {
		    specialDiscount = specialDiscount > 1 ? specialDiscount : 1;  // $1 discount for 7th show
		}
		
		Date showStartTime = showing.getShowStartTime();
		//TODO : Below code can be moved into different table (let's table for discount with start and end date)
		Date dStartTime = DateFormatter.getTime("11-00-00");
		Date dEndTime = DateFormatter.getTime("16-00-00");
		if(DateFormatter.getTime(showStartTime).after(dStartTime) && DateFormatter.getTime(showStartTime).before(dEndTime)) {
			double timeDis = movie.getTicketPrice() * 0.25;  // 25% discount for special movie
			specialDiscount = specialDiscount > timeDis ? specialDiscount : timeDis; 
		}
	    return specialDiscount;
	 }   
}
